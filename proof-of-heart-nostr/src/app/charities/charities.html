<div class="banner">
  <span>Nostr-native, nonprofit, always direct</span>
  <h1>Donate to Charities on Nostr</h1>
  <h2>Discover verified npubs and support via lightning or zaps</h2>
  <div class="buttons">
    <button class="primary" (click)="goForCharities()" mat-raised-button>
      For charities
      <i class="fa-solid fa-arrow-right"></i>
    </button>
    <button class="secondary" routerLink="/paper" mat-stroked-button>
      Our mission
    </button>
  </div>
</div>

<div class="filterbar">
  <div class="row">
    <input class="search" placeholder="Search charities, npubs, mission..." [(ngModel)]="filter_name" (input)="search(filter_name)">
    <div class="morefilters" (click)="showAdvanced = !showAdvanced" [ngClass]="{'active': showAdvanced}">
      <div class="label">Advanced</div>
      <i class="fa-solid fa-chevron-down"></i>
    </div>
  </div>
  <div class="row" *ngIf="showAdvanced">
    <label class="sr-only" for="category">Filter on category</label>
    <select id="category" class="select" [(ngModel)]="filter_category" (change)="filter()">
      <option value="">All Categories</option>
      <option *ngFor="let cat of categories" [ngValue]="cat">{{ cat }}</option>
    </select>

    <label class="sr-only" for="country">Filter on country</label>
    <select id="country" class="select" [(ngModel)]="filter_country" (change)="filter()">
      <option value="">All Countries</option>
      <option *ngFor="let country of countries" [ngValue]="country">{{ country }}</option>
    </select>
  </div>
</div>

<div class="loading-wrap" *ngIf="loading">
  <mat-spinner diameter="42"></mat-spinner>
  <span>Searching relays for charity profiles...</span>
</div>

<div class="charities" *ngIf="!loading">
  @for (charity of charities; track charity.pubkey) {
    <div class="charity">
      <div class="top">
        <img [src]="charity.picture || '/assets/logo-contrast.png'" alt="">
        <div class="spacer"></div>
        <div class="title">
          <h2>{{ charity.name }}</h2>
          <span class="charity-meta" *ngIf="charity.charity.category">
            <i class="fa-solid fa-folder"></i>
            {{ charity.charity.category }}
          </span>
          <span class="charity-meta" *ngIf="charity.charity.country">
            <i class="fa-solid fa-location-dot"></i>
            {{ charity.charity.country }}
          </span>
          <span class="charity-meta">
            <i class="fa-solid fa-users"></i>
            {{ charity.followers }} followers
          </span>
        </div>
      </div>
      <div class="middle">
        <p>{{ charity.about || charity.charity.mission || 'No charity description yet.' }}</p>
      </div>
      <div class="bottom">
        <a [routerLink]="['/charities', charity.npub]" class="primary action-link">
          <i class="fa-brands fa-bitcoin"></i>
          Open profile
        </a>
      </div>
    </div>
  } @empty {
    <span>No charities found</span>
  }
</div>
