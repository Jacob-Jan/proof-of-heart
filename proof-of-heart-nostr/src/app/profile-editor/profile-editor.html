<section class="mat-card">
  <div [ngClass]="model.isVisible !== false ? 'public' : 'hidden'" class="status-chip">
    <i class="fa-solid fa-circle fa-2xs statusdot"></i>
    {{ model.isVisible !== false ? 'Public' : 'Hidden' }}
  </div>

  <div class="account-card">
    <h1>Charity Nostr Profile</h1>
    <p class="subtitle">Connect your Nostr signer, then publish your Proof of Heart charity profile.</p>

    @if (loadingExisting) {
      <p class="subtitle">Loading existing profile dataâ€¦</p>
    } @else if (needsSignerForLoad) {
      <p class="subtitle">Could not load existing profile data yet. Connect your signer and try again.</p>
      <button type="button" (click)="loadExisting()">Connect signer & load profile</button>
    }

    <form (ngSubmit)="save()" class="account-form">
      <p class="appear-in-register">
        <mat-checkbox [(ngModel)]="model.isVisible" name="isVisible">Appear in register</mat-checkbox>
      </p>

      <label>Charity name (from kind 0)</label>
      <input [value]="kind0Name || 'No kind-0 name found yet'" readonly />

      <label>Short description (kind 0, overridable)</label>
      <textarea [(ngModel)]="model.shortDescription" name="shortDescription" rows="3" placeholder="Short summary shown under your name"></textarea>

      <label>Description (long)</label>
      <textarea [(ngModel)]="model.description" name="description" rows="6" placeholder="Long description shown in the More about section"></textarea>

      <label>Country</label>
      <select [(ngModel)]="model.country" name="country">
        <option value="">Select country</option>
        @for (country of countries; track country) {
          <option [value]="country">{{ country }}</option>
        }
      </select>

      <label>Category</label>
      <select [(ngModel)]="model.category" name="category">
        <option value="">Select category</option>
        @for (category of categories; track category) {
          <option [value]="category">{{ category }}</option>
        }
      </select>

      <label>Lightning address (optional override)</label>
      <input [(ngModel)]="model.lightningAddress" name="lightningAddress" placeholder="name@domain.com" />

      <div class="account-buttons">
        <button mat-flat-button type="submit">Save profile</button>
        @if (ownNpub) {
          <a [routerLink]="['/charities', ownNpub]">
            <button mat-stroked-button type="button" class="secondary">View profile</button>
          </a>
        }
        <button mat-stroked-button type="button" class="secondary" (click)="disconnect()">Disconnect</button>
      </div>
    </form>
  </div>
</section>
